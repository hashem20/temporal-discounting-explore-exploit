% @ Hashem Sadeghiyeh
% 9/25/2019
% UPDATED 12/18/2019

% These codes calculate model-free parameters for the Horizon bandit task. It mainly computes p(high info): the probablity of chossing
% the more uncertain option (between two bandits) and p(low mean): the probbality of choosing the option with lower mean reward, in each
% horizon 1 and 6 conditions and then give the directed and random exploration as: directed exploration = p(high info) h6 - p(high info)
% h1; random exploration = p(low mean) h6 - p(low mean) h1. It also calculates Accurary: the probability of choosing the highr mean
% (wiser) option and the reaction times in each horizon conditions (1 or 6). Temporal discounting scores are imported from an external
% excel file. 


%% task load
clear all; clc;
%% *********  put the root (where main.m and folder "task" are located) as directory ************
directory = '/Users/hashem/MATLAB-Drive/git_temporal'; 
task_dir = strcat (directory, '/task/');
addpath('sigstar'); % putting * on graphs
% load    
g = (dir([task_dir, '*horizon*.mat']));
for j = 1:length (g)
    exp17(j) = load (g(j).name);
end

%% task parameters for each game
i = 1; % subject #
j = 1; % game #
totalh1=0; totalh6=0; %counting h1 and h6 games
total13 = 0; total22 = 0; %counting number of 13 and 22 conditions
totallm = 0; %counting number of 22 conditions in which av1 ~= av2
totalac = 0; %counting number of all trials in whcih av1 ~= av2 so we can assess accuracy
    for i = 1:length(exp17)
        while size(exp17(i).game(j).key) == [1 10] | size(exp17(i).game(j).key) == [1 5]
            
            sub(i).subID = exp17(i).subjectID + 17000;
            sub(i).isactive = (exp17(i).game(1).RT(1) ~= 0);
            sub(i).g(j).h = exp17(i).game(j).gameLength - 4; %horizon 1 or 6
            
            if sub(i).g(j).h == 1 %counting h1 and h6 games
                totalh1 = totalh1 + 1;
            elseif sub(i).g(j).h == 6
                totalh6 = totalh6 + 1;
            end

            if sum(exp17(i).game(j).nforced ==1) == 1         % uncertainty = 0,1,2  
                sub(i).g(j).uc = 1; % option 1 is uncertain
                total13 = total13 + 1;
                
            elseif sum(exp17(i).game(j).nforced ==1) == 3
                sub(i).g(j).uc = 2; % option 2 is uncertain
                 total13 = total13 + 1;
            elseif sum(exp17(i).game(j).nforced ==1) == 2
                sub(i).g(j).uc = 0;
                total22 = total22 + 1;
            end
            
            if sub(i).g(j).uc ~= 0
                 sub(i).g(j).hi = (exp17(i).game(j).key(5) == sub(i).g(j).uc);    % high info choice, yes =1, no =0
            else
                sub(i).g(j).hi = NaN;
            end
       
            sub(i).g(j).rt5 = exp17(i).game(j).RT(5); %reaction time at trial 5
            
            av1 = sum((2 - exp17(i).game(j).nforced).*exp17(i).game(j).rewards(1, 1:4))/sum(exp17(i).game(j).nforced ==1);
            av2 = sum((exp17(i).game(j).nforced - 1).*exp17(i).game(j).rewards(2, 1:4))/sum(exp17(i).game(j).nforced ==2);
            
            sub(i).g(j).dR = av2 - av1;
            sub(i).g(j).c5 = exp17(i).game(j).key(5) == 1;
            
            if sub(i).g(j).uc == 0 
                if av1 == av2
                    sub(i).g(j).lm = NaN
                elseif ((av1 < av2) &&(exp17(i).game(j).key(5) == 1))
                    sub(i).g(j).lm = 1;
                    totallm = totallm +1;
                elseif ((av1 > av2) &&(exp17(i).game(j).key(5) == 2))
                    sub(i).g(j).lm = 1;
                    totallm = totallm +1;
                else
                    sub(i).g(j).lm = 0;
% OLDER else; SAME RESULTS             
%                 else
%                   sub(i).g(j).lm = ((av1 < av2) & (exp17(i).game(j).key(5) == 1)) | ((av1 > av2) & (exp17(i).game(j).key(5) == 2)); % low mean choice, yes =1, no =0    
                end
            end
           
            if sub(i).g(j).h == 6  %reaction times (for 6 trials) for horizon 6 
                sub(i).g(j).rt_h6(1:6) = exp17(i).game(j).RT(5:10);
            end
% accuracy
            if av1 == av2
                    sub(i).g(j).ac = NaN
                elseif ((av1 < av2) &&(exp17(i).game(j).key(5) == 2))
                    sub(i).g(j).ac = 1;
                    totalac = totalac +1;
                elseif ((av1 > av2) &&(exp17(i).game(j).key(5) == 1))
                    sub(i).g(j).ac = 1;
                    totalac = totalac +1;
                else
                    sub(i).g(j).ac = 0;
            end
                    
%             sub(i).g(j).ac = exp17(i).game(j).accuracy;

            j = j+1;
        end
        sub(i).ngames = j-1; j=1;
        sub(i).h1games = totalh1; totalh1 = 0;
        sub(i).h6games = totalh6; totalh6 = 0;
        sub(i).games13 = total13; total13 = 0;
        sub(i).games22 = total22; total22 = 0;
        sub(i).gameslm = totallm; totallm = 0;
        sub(i).gamesac = totalac; totalac = 0;
    end

%% average task parameters for each subject
sum_hi1=0; total13_h1 = 0;
sum_hi6=0; total13_h6 = 0;
sum_lm1=0; totallm_h1 = 0;
sum_lm6=0; totallm_h6 = 0;
sum_ac1=0; totalac_h1 = 0;
sum_ac6=0; totalac_h6 = 0;
sum_RT1=0; 
sum_RT6=0;  

    for i = 1:length(sub)
        nn = sub(i).ngames
%       nn = min(sub(i).ngames, 160);
        for j = 1:nn
            if sub(i).g(j).h == 1 && sub(i).g(j).uc ~=0 && sub(i).g(j).hi 
                sum_hi1=sum_hi1+1;
            end
            if sub(i).g(j).uc ~=0 && sub(i).g(j).h == 1
               total13_h1 = total13_h1 + 1;
            end
            if sub(i).g(j).h == 6 && sub(i).g(j).uc ~=0 && sub(i).g(j).hi
                sum_hi6 = sum_hi6 +1;
            end
             if sub(i).g(j).uc ~=0 && sub(i).g(j).h ==6 
                total13_h6 = total13_h6 + 1;
            end
            if sub(i).g(j).uc == 0 && sub(i).g(j).h == 1 && ~isnan(sub(i).g(j).lm) && sub(i).g(j).lm 
               sum_lm1 = sum_lm1 + 1;
            end
            if sub(i).g(j).uc ==0 && sub(i).g(j).h ==1 && ~isnan(sub(i).g(j).lm)
               totallm_h1 = totallm_h1 +1;
            end
            if sub(i).g(j).uc ==0 && sub(i).g(j).h == 6 && ~isnan(sub(i).g(j).lm) && sub(i).g(j).lm
               sum_lm6 = sum_lm6 + 1;
            end
            if sub(i).g(j).uc ==0 && sub(i).g(j).h ==6 && ~isnan(sub(i).g(j).lm)
               totallm_h6 = totallm_h6 + 1;
            end
            % AC
            if ~isnan(sub(i).g(j).ac)
                if (sub(i).g(j).h ==1) 
                    sum_ac1 = sum_ac1 + sub(i).g(j).ac;
                    totalac_h1 = totalac_h1 + 1;
                elseif (sub(i).g(j).h ==6) 
                    sum_ac6 = sum_ac6 + sub(i).g(j).ac;
                    totalac_h6 = totalac_h6 + 1;
                end
            end
            % RT
            if (sub(i).g(j).h ==1)
                sum_RT1 = sum_RT1 + sub(i).g(j).rt5;
            elseif (sub(i).g(j).h ==6)
                sum_RT6 = sum_RT6 + sub(i).g(j).rt5;
            end
        end
        
        sub(i).total13_h1 = total13_h1;
        sub(i).total13_h6 = total13_h6;
        sub(i).totallm_h1 = totallm_h1;
        sub(i).totallm_h6 = totallm_h6;
        sub(i).totalac_h1 = totalac_h1;
        sub(i).totalac_h6 = totalac_h6;
        
        sub(i).phi1 = sum_hi1/total13_h1;
        sub(i).phi6 = sum_hi6/total13_h6;
        sub(i).plm1 = sum_lm1/totallm_h1;
        sub(i).plm6 = sum_lm6/totallm_h6;
        sub(i).direct = sub(i).phi6 - sub(i).phi1;
        sub(i).random = sub(i).plm6 - sub(i).plm1;
        sub(i).ac1 = sum_ac1/totalac_h1;
        sub(i).ac6 = sum_ac6/totalac_h6;
        sub(i).RT1 = sum_RT1/sub(i).h1games;
        sub(i).RT6 = sum_RT6/sub(i).h6games;
        
        sum_hi1=0; total13_h1 = 0;
        sum_hi6=0; total13_h6 = 0;
        sum_lm1=0; totallm_h1 = 0;
        sum_lm6=0; totallm_h6 = 0;
        sum_ac1=0; totalac_h1 = 0;
        sum_ac6=0; totalac_h6 = 0;
        sum_RT1=0; 
        sum_RT6=0; 
    end
 %%  MODEL BASED
for i = 1:length(sub)
    for j = 1:length(sub(i).g)
        dR(j) = sub(i).g(j).dR;
        I(j) = sub(i).g(j).I;
        c5(j) = sub(i).g(j).c5;
        h(j) = sub(i).g(j).h;
    end
    xfit = model1(h, dR, I, c5);
    sub(i).alpha13_1 = xfit.x13_h1(1);   % informaion bonus
    sub(i).B13_1 = xfit.x13_h1(2);       %spatial bias
    sub(i).sigma13_1 = xfit.x13_h1(3);   % noise
    
    sub(i).alpha13_6 = xfit.x13_h6(1);   % informaion bonus
    sub(i).B13_6 = xfit.x13_h6(2);       %spatial bias
    sub(i).sigma13_6 = xfit.x13_h6(3);   % noise
    
    sub(i).alpha22_1 = xfit.x22_h1(1);   % informaion bonus
    sub(i).B22_1 = xfit.x22_h1(2);       %spatial bias
    sub(i).sigma22_1 = xfit.x22_h1(3);   % noise
    
    sub(i).alpha22_6 = xfit.x22_h6(1);   % informaion bonus
    sub(i).B22_6 = xfit.x22_h6(2);       %spatial bias
    sub(i).sigma22_6 = xfit.x22_h6(3);   % noise

    clear dR I c5 h;
 %% 
for i=1:length(sub)
    phi1(i)   = sub(i).phi1;
    phi6(i)   = sub(i).phi6;
    
    plm1(i)   = sub(i).plm1;
    plm6(i)   = sub(i).plm6;
    
    alpha13_1(i) = sub(i).alpha13_1;
    alpha13_6(i) = sub(i).alpha13_6;
    
    sigma13_1(i) = sub(i).sigma13_1;
    sigma13_6(i) = sub(i).sigma13_6;
    
    alpha22_1(i) = sub(i).alpha22_1;
    alpha22_6(i) = sub(i).alpha22_6;
    
    sigma22_1(i) = sub(i).sigma22_1;
    sigma22_6(i) = sub(i).sigma22_6;

    model_direct13(i) = sub(i).alpha13_6 - sub(i).alpha13_1;
    model_random22(i) = sub(i).sigma22_6 - sub(i).sigma22_1;
    direct(i) = sub(i).direct;
    random(i) = sub(i).random;
end
 %%
for i=1:length(sub)
    bb(i,1) = sub(i).subID;  
    bb(i,2) = sub(i).phi1; bb(i,3) =sub(i).phi6; 
    bb(i,4) = sub(i).plm1; bb(i,5) = sub(i).plm6; 
    bb(i,6) = sub(i).ac1; bb(i,7) = sub(i).ac6; 
    bb(i,8) = sub(i).RT1; bb(i,9) = sub(i).RT6; 
    bb(i,10) = sub(i).direct; bb(i,11) = sub(i).random;
    bb(i,12) = model_direct13(i);
    bb(i,13) = sub(i).sigma22_6 - sub(i).sigma22_1;
    bb(i,14) = sub(i).alpha13_1;
    bb(i,15) = sub(i).alpha13_6;
    bb(i,16) = sub(i).sigma22_1;
    bb(i,17) = sub(i).sigma22_6;
end
bb = sortrows (bb, 1, 'descend');
bb = sortrows (bb, 2);

%% temporal
[temporal, titles, ~] = xlsread ('Temporal_Discounting_Scores.xlsx');
 %% label
 label(14:18)= titles(1,31:35); label{1,19} = '# today items';  label{1,18} = 'Geomean k';
 label{1,1} = 'Sub_ID_task'; 
 label{1,2} = 'p(high_info)_h1'; label{1,3} = 'p(high_info)_h6'; 
 label{1,4} = 'p(low_mean)_h1'; label{1,5} = 'p(low_mean)_h6'; 
 label{1,6} = 'accuracy_h1'; label{1,7} = 'accuracy_h6'; 
 label{1,8} = 'reaction_time_h1'; label{1,9} = 'reaction_time_h6';
 label{1,10} = 'directed_exploration'; label{1,11} = 'random_exploration'; 
 label{1,12} = 'gender'; label{1,13} = 'age';
 
 %% matching Sub_IDs 
 M=0;
 for i=1:length(bb)
     for j=1:length(temporal)
         if bb(i,1) == temporal (j,1)
             M = M+1;
             e(M,1:11) = bb(i,1:11); 
             e(M, 12:13) = temporal (j, 2:3);  % gender, age
             e(M, 14:19) = temporal (j, 31:36); % 5 k's, #todays
             e(M, 20:25) = bb(i, 12:17)
         end
     end
 end
%% gender, age
average_age = mean(e(:,16))
max_age = max(e(:,16))
min_age = min(e(:,16))

number_of_males = length(find(e(:,15)==1))
number_of_females = length(find(e(:,15)==2))

%% ******************************************** FIGURE 2 *****************************************************
%% scatter p(high info) and p(low mean) two horizons
figure(5);
subplot(1,2,1)
scatter(e(:,2), e(:,3), 300, AZred, '.'); hold on
plot(linspace(0,1), linspace(0,1), '--', 'color', AZblue, 'LineWidth',2)
set(gca,'fontsize',18)
xlim([0 1])
ylim([0 1])
yticks([0, .5, 1])
xlabel('horizon 1', 'FontSize', 28)
ylabel('horizon 6', 'FontSize', 28)
title('p(high info)', 'FontSize', 35)

subplot(1,2,2)
scatter(e(:,4), e(:,5), 300, AZred, '.'); hold on
plot(linspace(0,1), linspace(0,1), '--', 'color', AZblue, 'LineWidth',2)
set(gca,'fontsize',18)
xlim([0 1])
ylim([0 1])
line([0, 0],[1, 1],'linestyle','--')
xlabel('horizon 1', 'FontSize', 28)
ylabel('horizon 6', 'FontSize', 28)
yticks([0, .5, 1])
title('p(low mean)', 'FontSize', 35)

annotation('textbox', [0.03, 1, 0, 0], 'string', 'A', 'FontSize',50, 'fontweight','bold');
annotation('textbox', [0.48, 1, 0, 0], 'string', 'B', 'FontSize',50, 'fontweight','bold')

% number of cases over the line
sum(e(:,3)>e(:,2))
sum(e(:,3)<e(:,2))
sum(e(:,5)>e(:,4))
sum(e(:,5)<e(:,4))

%% ******************************************** FIGURE 3 *****************************************************
%% plot horizon task basic   

phi(1) = mean(e(:,5)); s_phi(1) = std(e(:,5))/sqrt(length(e(:,5)));
phi(2) = mean(e(:,6)); s_phi(2) = std(e(:,6))/sqrt(length(e(:,6)));
plow(1) = mean(e(:,7)); s_plow(1) = std(e(:,7))/sqrt(length(e(:,7)));
plow(2) = mean(e(:,8)); s_plow(2) = std(e(:,8))/sqrt(length(e(:,8)));
%% t test phi & plow
[h, p,~, t] = ttest(e(:,5), e(:, 6)) %phi
[h2, p2,~, t2] = ttest(e(:,7), e(:, 8)) %plow

%% Arizona color palette
AZred = [171,5,32]/256;
AZblue = [12,35,75]/256;
AZcactus = [92, 135, 39]/256;
AZsky = [132, 210, 226]/256;
AZriver = [7, 104, 115]/256;
AZsand = [241, 158, 31]/256;
AZmesa = [183, 85, 39]/256;
AZbrick = [74, 48, 39]/256;
%%
figure(1);
subplot(1,2,1); set(0,'DefaultAxesTitleFontWeight','normal');

plot([1 6], phi,"-", 'marker', 'diamond', 'LineWidth',6,...
    'MarkerSize',30,...
    'MarkerEdgeColor',AZred,...
    'MarkerFaceColor',AZred,...
    'Color', AZred); hold on;
errorbar([1 6], phi, s_phi, 'Color', AZred, 'LineWidth',3); box off;

sigstar({[1,6]},p)

xlim([-2 9])
xticks([1 6])
ylim([.4 .6])
yticks([.4 .5 .6])

xlabel('horizon')
ylabel('p(high info)')
title('directed exploration')
set(gca,'FontSize',40)

subplot(1,2,2);
plot([1 6], plow,"-", 'marker', 'diamond', 'LineWidth',6,...
    'MarkerSize',30,...
    'MarkerEdgeColor',AZblue,...
    'MarkerFaceColor',AZblue,...
    'Color', AZblue); hold on; errorbar([1 6], plow, s_plow, 'Color', AZblue, 'LineWidth',3); box off;

sigstar({[1,6]},p2)

xlim([-2 9])
xticks([1 6])
ylim([.2 .4])
yticks([.2 .3 .4])
xlabel('horizon')
ylabel('p(low mean)')
title('random exploration')

set(gca,'FontSize',40)
annotation('textbox', [0.03, 1, 0, 0], 'string', 'A', 'FontSize',60, 'fontweight','bold');
annotation('textbox', [0.48, 1, 0, 0], 'string', 'B', 'FontSize',60, 'fontweight','bold')
annotation('textbox', [0.024, 0.11, 0, 0], 'String', '- p=.08', 'FontSize',30, 'FitBoxToText', 'on', 'LineStyle', 'none')
annotation('textbox', [0.01, 0.06, 0, 0], 'String', '*** p<.001', 'FontSize',30, 'FitBoxToText', 'on', 'LineStyle', 'none')

%% ************************************************** FIGURE 4 *******************************************
%% distribution of horizon parameters in the sample
figure(6);
subplot(3, 2, 1)
histogram(e(:,2), 'Facecolor', AZsand)
set(gca,'fontsize',18)
xlabel('p(high info) h1', 'FontSize', 25)

subplot(3, 2, 3)
histogram(e(:,3), 'Facecolor', AZsand)
set(gca,'fontsize',18)
xlabel('p(high info) h6', 'FontSize', 25)

subplot(3, 2, 5)
histogram(e(:,10), 'Facecolor', AZsand)
set(gca,'fontsize',18)
xlabel('directed exploration', 'FontSize', 25)

subplot(3, 2, 2)
histogram(e(:,4), 'Facecolor', AZsand)
set(gca,'fontsize',18)
xlabel('p(low mean) h1', 'FontSize', 25)

subplot(3, 2, 4)
histogram(e(:,5), 'Facecolor', AZsand)
set(gca,'fontsize',18)
xlabel('p(low mean) h6', 'FontSize', 25)

subplot(3, 2, 6)
histogram(e(:,11), 'Facecolor', AZsand)
set(gca,'fontsize',18)
xlabel('random exploration', 'FontSize', 25)

%% ************************************************** TABLE 1 *******************************************
%% range of k's and # todays    
kk(1).name = '....';
kk(2).name = 'Overall k';
kk(3).name = 'Small k';
kk(4).name = 'Medium k';
kk(5).name = 'Large k';
kk(6).name = 'Geomean k';
kk(7).name = '# today items';
kk(1).min = 'min';
kk(1).max = 'max';
kk(1).mean = 'mean';
for i = 2:7
    kk(i).min = min(e(:,15+i));
    kk(i).max = max(e(:,15+i));
    kk(i).mean = mean(e(:,15+i));
end

%% ****************************************************** FIGURE 5 ****************************************************
%% plot # today items    
figure(2);
subplot(3,2,1)
scatter(e(:,22), e(:,5),100, AZred, '.'); hold on % p high info h1
p = polyfit(e(:,22), e(:,5),1)
f = polyval(p,e(:,22))
plot(e(:,22), f, 'color', AZblue, 'LineWidth',3)
ylabel('p(high info) h1')
% xlabel('# today items')
ylim([0,1.1])
 set(gca,'FontSize',20)
title('directed exploration', 'FontSize', 30)
[r, p] = corr(e(:,22), e(:,5));
text(1,1,strcat('r =', {' '},num2str(round(r*100)/100),' ; p =',{' '}, num2str(round(p*1000)/1000)), 'FontWeight','Normal', 'FontSize',17)

% subaxis(3,2,1, 'Margin',.4)

subplot(3,2,3)
scatter(e(:,22), e(:,6), 100, AZred,'.'); hold on % p high info h6
p = polyfit(e(:,22), e(:,6),1)
f = polyval(p,e(:,22))
plot(e(:,22), f, 'color', AZblue, 'LineWidth',3)
ylabel('p(high info) h6')
% xlabel('# today items')
ylim([0,1])
set(gca,'FontSize',20)

[r, p] = corr(e(:,22), e(:,6));
text(1,1,strcat('r =', {' '},num2str(round(r*100)/100),' ; p =',{' '}, num2str(round(p*1000)/1000)), 'FontWeight','Normal', 'FontSize',17)

subplot(3,2,2)
scatter(e(:,22), e(:,7), 100, AZred,'.'); hold on % p low mean h1
p = polyfit(e(:,22), e(:,7),1)
f = polyval(p,e(:,22))
plot(e(:,22), f, 'color', AZblue, 'LineWidth',3)
ylabel('p(low mean) h1')
% xlabel('# today items')
ylim([0,1.1])
set(gca,'FontSize',20)
title('random exploration', 'FontSize', 30)

[r, p] = corr(e(:,22), e(:,7));
text(1,1,strcat('r =', {' '},num2str(round(r*100)/100),' ; p =',{' '}, num2str(round(p*1000)/1000)), 'FontWeight','Normal', 'FontSize',17)


subplot(3,2,4)
scatter(e(:,22), e(:,8), 100, AZred,'.'); hold on % p low mean h6
p = polyfit(e(:,22), e(:,8),1)
f = polyval(p,e(:,22))
plot(e(:,22), f, 'color', AZblue, 'LineWidth',3)
ylabel('p(low mean) h6')
% xlabel('# today items')
ylim([0,1])
set(gca,'FontSize',20)
[r, p] = corr(e(:,22), e(:,8));
text(1,1,strcat('r =', {' '},num2str(round(r*100)/100),' ; p =',{' '}, num2str(round(p*1000)/1000)), 'FontWeight','Normal', 'FontSize',17)


subplot(3,2,5)
scatter(e(:,22), e(:,13), 100, AZred,'.'); hold on % directed
p = polyfit(e(:,22), e(:,13),1)
f = polyval(p,e(:,22))
plot(e(:,22), f, 'color', AZblue, 'LineWidth',3)
ylabel('directed exp.')
xlabel('# today items')
ylim([-.6,.65])
set(gca,'FontSize',20)
[r, p] = corr(e(:,22), e(:,13));
text(1,.65,strcat('r =', {' '},num2str(round(r*100)/100),' ; p =',{' '}, num2str(round(p*1000)/1000)), 'FontWeight','Normal', 'FontSize',17)


subplot(3,2,6)
scatter(e(:,22), e(:,14), 100, AZred,'.'); hold on % random
p = polyfit(e(:,22), e(:,14),1)
f = polyval(p,e(:,22))
plot(e(:,22), f, 'color', AZblue, 'LineWidth',3)
ylabel('random exp.')
xlabel('# today items')
ylim([-.6,.65])
set(gca,'FontSize',20)
[r, p] = corr(e(:,22), e(:,14));
text(1,.65,strcat('r =', {' '},num2str(round(r*100)/100),' ; p =',{' '}, num2str(round(p*1000)/1000)), 'FontWeight','Normal', 'FontSize',17)

annotation('textbox', [0.04, .97, 0, 0], 'string', 'A', 'FontSize',30, 'fontweight','bold');
annotation('textbox', [0.485, .97, 0, 0], 'string', 'B', 'FontSize',30, 'fontweight','bold')
annotation('textbox', [0.04, .67, 0, 0], 'string', 'C', 'FontSize',30, 'fontweight','bold');
annotation('textbox', [0.485, .67, 0, 0], 'string', 'D', 'FontSize',30, 'fontweight','bold')
annotation('textbox', [0.04, .36, 0, 0], 'string', 'E', 'FontSize',30, 'fontweight','bold');
annotation('textbox', [0.485, .36, 0, 0], 'string', 'F', 'FontSize',30, 'fontweight','bold')

%% ***********************************************  Table 2 ***********************************************
%% correlations log overall k  
clear R P;
    x=0;
for i=5:16
         [R,P] = corrcoef (e(:,i), log(e(:,17)), 'rows', 'complete');
         if P(1,2) < 1.01
            x=x+1;
            c_a_logk(x).parameter = (label(i));
            c_a_logk(x).temp_index = (label(17));
            c_a_logk(x).r = R(1,2);
            c_a_logk(x).p = P(1,2);
            N=0;
            for k=1:length(e)
                if ~isnan(e(k,i)) && ~isnan(e(k,17))
                    N=N+1;
                end
            end
            c_a_logk(x).N = N;
         end
end
%% ***********************************************  Figure S1 ***********************************************
%% SCATTER PLOT Figure S1
figure(1); 
subplot(3, 2, 1)
scatter(phi1, alpha13_1, 100, AZred, '.'); hold on 
p = polyfit(phi1, alpha13_1,1)
f = polyval(p, phi1)
plot(phi1, f, 'color', AZblue, 'LineWidth',3)
ylabel('info bonus h1')
xlabel('p(high info) h1')
% ylim([0,1.1])
set(gca,'FontSize',20)
t = title('directed exploration', 'FontSize', 30)
pos = get(t, 'Position');
pos(2) = pos(2) + 2;
set(t, 'Position', pos);
[r, p] = corr(phi1', alpha13_1');
text(.21,23,strcat('r =', {' '}, num2str(round(r*100)/100),' ; p < 0.001'),'FontWeight','Normal', 'FontSize',17)

subplot(3,2,3)
scatter(phi6, alpha13_6, 100, AZred, '.'); hold on 
p = polyfit(phi6, alpha13_6,1)
f = polyval(p, phi6)
plot(phi6, f, 'color', AZblue, 'LineWidth',3)
ylabel('info bonus h6')
xlabel('p(high info) h6')
% ylim([0,1.1])
set(gca,'FontSize',20)
% title('p(high info) & decision noise h6', 'FontSize', 30)
[r, p] = corr(phi6', alpha13_6');
text(.25,30,strcat('r =', {' '},num2str(round(r*100)/100),' ; p < 0.001'), 'FontWeight','Normal', 'FontSize',17)

subplot(3,2,5)
scatter(direct, model_direct13, 100, AZred, '.'); hold on 
p = polyfit(direct, model_direct13,1)
f = polyval(p, direct)
plot(direct, f, 'color', AZblue, 'LineWidth',3)
ylabel('model-based')
xlabel('model-free')
% ylim([0,1.1])
set(gca,'FontSize',20)
% title('directed exploration', 'FontSize', 30)
[r, p] = corr(direct', model_direct13');
text(-.26,25,strcat('r =', {' '},num2str(round(r*100)/100),' ; p < 0.001'), 'FontWeight','Normal', 'FontSize',17)

subplot(3,2,2)
scatter(plm1, sigma22_1, 100, AZred, '.'); hold on 
p = polyfit(plm1, sigma22_1, 1)
f = polyval(p, plm1)
plot(plm1, f, 'color', AZblue, 'LineWidth',3)
xlabel('p(low mean) h1')
ylabel('noise h1')
% ylim([0,1.1])
set(gca,'FontSize',20)
tt = title('random exploration', 'FontSize', 30)
pos2 = get(tt, 'Position');
pos2(2) = pos2(2) + 2;
set(tt, 'Position', pos2);
[r, p] = corr(plm1', sigma22_1');
text(.02,35,strcat('r =', {' '},num2str(round(r*100)/100),' ; p < 0.001'), 'FontWeight','Normal', 'FontSize',17)

subplot(3,2,4)
scatter(plm6, sigma22_6, 100, AZred, '.'); hold on 
p = polyfit(plm6, sigma22_6, 1)
f = polyval(p, plm6)
plot(plm6, f, 'color', AZblue, 'LineWidth',3)
xlabel('p(low mean) h6')
ylabel('noise h6')
% ylim([0,1.1])
set(gca,'FontSize',20)
% title('p(low mean) & decision noise h6', 'FontSize', 30)
[r, p] = corr(plm6', sigma22_6');
text(.02,30,strcat('r =', {' '},num2str(round(r*100)/100),' ; p < 0.001'), 'FontWeight','Normal', 'FontSize',17)

subplot(3,2,6)
scatter(random, model_random22, 100, AZred, '.'); hold on 
p = polyfit(random, model_random22,1)
f = polyval(p, random)
plot(random, f, 'color', AZblue, 'LineWidth',3)
xlabel('model-free')
ylabel('model-based')
% ylim([0,1.1])
set(gca,'FontSize',20)
% title('random exploration', 'FontSize', 30)
[r, p] = corr(random', model_random22');
text(-.47,18,strcat('r =', {' '},num2str(round(r*100)/100),' ; p < 0.001'), 'FontWeight','Normal', 'FontSize',17)

annotation('textbox', [0.04, .97, 0, 0], 'string', 'A', 'FontSize',30, 'fontweight','bold');
annotation('textbox', [0.485, .97, 0, 0], 'string', 'B', 'FontSize',30, 'fontweight','bold')
annotation('textbox', [0.04, .67, 0, 0], 'string', 'C', 'FontSize',30, 'fontweight','bold');
annotation('textbox', [0.485, .67, 0, 0], 'string', 'D', 'FontSize',30, 'fontweight','bold')
annotation('textbox', [0.04, .37, 0, 0], 'string', 'E', 'FontSize',30, 'fontweight','bold');
annotation('textbox', [0.485, .37, 0, 0], 'string', 'F', 'FontSize',30, 'fontweight','bold')


%% ***********************************************  Figure S2 ***********************************************
%% plot Figure sup: Scatter Plots  #today items and MODEL-BASED info bonus/noise/directed/random exploration
figure(7);
subplot(3,2,1)
scatter(e(:,19), e(:,22),100, AZred, '.'); hold on % p high info h1
p = polyfit(e(:,19), e(:,22),1)
f = polyval(p,e(:,19))
plot(e(:,19), f, 'color', AZblue, 'LineWidth',3)
ylabel('info bonus h1')
% xlabel('# today items')
% ylim([0,1.1])
 set(gca,'FontSize',20)
ti1 = title('directed exploration', 'FontSize', 30)
pos1 = get(ti1, 'Position');
pos1(2) = pos1(2) + 6;
set(ti1, 'Position', pos1);
[r, p] = corr(e(:,19), e(:,22));
text(1,25,strcat('r =', {' '},num2str(round(r*100)/100),' ; p =',{' '}, num2str(round(p*1000)/1000)), 'FontWeight','Normal', 'FontSize',17)

subplot(3,2,3)
scatter(e(:,19), e(:,23), 100, AZred,'.'); hold on % p high info h6
p = polyfit(e(:,19), e(:,23),1)
f = polyval(p,e(:,19))
plot(e(:,19), f, 'color', AZblue, 'LineWidth',3)
ylabel('info bonus h6')
% xlabel('# today items')
% ylim([0,1])
set(gca,'FontSize',20)

[r, p] = corr(e(:,19), e(:,23));
text(1,25,strcat('r =', {' '},num2str(round(r*100)/100),' ; p =',{' '}, num2str(round(p*1000)/1000)), 'FontWeight','Normal', 'FontSize',17)

subplot(3,2,2)
scatter(e(:,19), e(:,24), 100, AZred,'.'); hold on % p low mean h1
p = polyfit(e(:,19), e(:,24),1)
f = polyval(p,e(:,19))
plot(e(:,19), f, 'color', AZblue, 'LineWidth',3)
ylabel('noise h1')
% xlabel('# today items')
% ylim([0,1.1])
set(gca,'FontSize',20)
ti2 = title('random exploration', 'FontSize', 30)
pos2 = get(ti2, 'Position');
pos2(2) = pos2(2) - 3;
set(ti2, 'Position', pos2);
[r, p] = corr(e(:,19), e(:,24));
text(1,35,strcat('r =', {' '},num2str(round(r*100)/100),' ; p =',{' '}, num2str(round(p*1000)/1000)), 'FontWeight','Normal', 'FontSize',17)

subplot(3,2,4)
scatter(e(:,19), e(:,25), 100, AZred,'.'); hold on % p low mean h6
p = polyfit(e(:,19), e(:,25),1)
f = polyval(p,e(:,19))
plot(e(:,19), f, 'color', AZblue, 'LineWidth',3)
ylabel('noise h6')
% xlabel('# today items')
% ylim([0,1])
set(gca,'FontSize',20)
[r, p] = corr(e(:,19), e(:,25));
text(1,29,strcat('r =', {' '},num2str(round(r*100)/100),' ; p =',{' '}, num2str(round(p*1000)/1000)), 'FontWeight','Normal', 'FontSize',17)

subplot(3,2,5)
scatter(e(:,19), e(:,20), 100, AZred,'.'); hold on % directed
p = polyfit(e(:,19), e(:,20),1)
f = polyval(p,e(:,19))
plot(e(:,19), f, 'color', AZblue, 'LineWidth',3)
ylabel('directed exp.')
xlabel('# today items')
% ylim([-.6,.65])
set(gca,'FontSize',20)
[r, p] = corr(e(:,19), e(:,20));
text(1,25,strcat('r =', {' '},num2str(round(r*100)/100),' ; p =',{' '}, num2str(round(p*1000)/1000)), 'FontWeight','Normal', 'FontSize',17)

subplot(3,2,6)
scatter(e(:,19), e(:,21), 100, AZred,'.'); hold on % random
p = polyfit(e(:,19), e(:,21),1)
f = polyval(p,e(:,19))
plot(e(:,19), f, 'color', AZblue, 'LineWidth',3)
ylabel('random exp.')
xlabel('# today items')
% ylim([-.6,.65])
set(gca,'FontSize',20)
[r, p] = corr(e(:,19), e(:,21));
text(1,-22,strcat('r =', {' '},num2str(round(r*100)/100),' ; p =',{' '}, num2str(round(p*1000)/1000)), 'FontWeight','Normal', 'FontSize',17)

annotation('textbox', [0.04, .97, 0, 0], 'string', 'A', 'FontSize',30, 'fontweight','bold');
annotation('textbox', [0.485, .97, 0, 0], 'string', 'B', 'FontSize',30, 'fontweight','bold')
annotation('textbox', [0.04, .67, 0, 0], 'string', 'C', 'FontSize',30, 'fontweight','bold');
annotation('textbox', [0.485, .67, 0, 0], 'string', 'D', 'FontSize',30, 'fontweight','bold')
annotation('textbox', [0.04, .36, 0, 0], 'string', 'E', 'FontSize',30, 'fontweight','bold');
annotation('textbox', [0.485, .36, 0, 0], 'string', 'F', 'FontSize',30, 'fontweight','bold')


%% ***********************************************  Figure S3 ***********************************************
ee = e;
e(:,14:18) = log(e(:,14:18));
for i=1:5
    label{1,13+i} = strcat('log ',{' '}, label{1,13+i})
end
%% correlations scatter-plots between temporal discounting measures
figure(4); 
subplot(5, 3, 1)
scatter(e(:,14), e(:,15), 100, AZred, '.'); hold on 
p = polyfit(e(:,14), e(:,15),1)
f = polyval(p, e(:,14))
plot(e(:,14), f, 'color', AZblue, 'LineWidth',3)
ylabel(label{1,15})
xlabel(label{1,14})
% ylim([0,1.1])
set(gca,'FontSize',12)
[r, p] = corr(e(:,14), e(:,15));
text(-7.3,-.5,strcat('r =', {' '}, num2str(round(r*100)/100)),'FontWeight','Normal', 'FontSize',12)

subplot(5, 3, 2)
scatter(e(:,14), e(:,16), 100, AZred, '.'); hold on 
p = polyfit(e(:,14), e(:,16),1)
f = polyval(p, e(:,14))
plot(e(:,14), f, 'color', AZblue, 'LineWidth',3)
ylabel(label{1,16})
xlabel(label{1,14})
% ylim([0,1.1])
set(gca,'FontSize',12)
[r, p] = corr(e(:,14), e(:,16));
text(-7.3,-.5,strcat('r =', {' '}, num2str(round(r*100)/100)),'FontWeight','Normal', 'FontSize',12)

subplot(5, 3, 3)
scatter(e(:,14), e(:,17), 100, AZred, '.'); hold on 
p = polyfit(e(:,14), e(:,17),1)
f = polyval(p, e(:,14))
plot(e(:,14), f, 'color', AZblue, 'LineWidth',3)
ylabel(label{1,17})
xlabel(label{1,14})
% ylim([0,1.1])
set(gca,'FontSize',12)
[r, p] = corr(e(:,14), e(:,17));
text(-7.3,-.5,strcat('r =', {' '}, num2str(round(r*100)/100)),'FontWeight','Normal', 'FontSize',12)

subplot(5, 3, 4)
scatter(e(:,14), e(:,18), 100, AZred, '.'); hold on 
p = polyfit(e(:,14), e(:,18),1)
f = polyval(p, e(:,14))
plot(e(:,14), f, 'color', AZblue, 'LineWidth',3)
ylabel(label{1,18})
xlabel(label{1,14})
% ylim([0,1.1])
set(gca,'FontSize',12)
[r, p] = corr(e(:,14), e(:,18));
text(-7.3,-.5,strcat('r =', {' '}, num2str(round(r*100)/100)),'FontWeight','Normal', 'FontSize',12)

subplot(5, 3, 5)
scatter(e(:,14), e(:,19), 100, AZred, '.'); hold on 
p = polyfit(e(:,14), e(:,19),1)
f = polyval(p, e(:,14))
plot(e(:,14), f, 'color', AZblue, 'LineWidth',3)
ylabel(label{1,19})
xlabel(label{1,14})
% ylim([0,1.1])
set(gca,'FontSize',12)
[r, p] = corr(e(:,14), e(:,19));
text(-7.3,28,strcat('r =', {' '}, num2str(round(r*100)/100)),'FontWeight','Normal', 'FontSize',12)

subplot(5, 3, 6)
scatter(e(:,15), e(:,16), 100, AZred, '.'); hold on 
p = polyfit(e(:,15), e(:,16),1)
f = polyval(p, e(:,15))
plot(e(:,15), f, 'color', AZblue, 'LineWidth',3)
ylabel(label{1,16})
xlabel(label{1,15})
% ylim([0,1.1])
set(gca,'FontSize',12)
[r, p] = corr(e(:,15), e(:,16));
text(-6.2, -.5,strcat('r =', {' '}, num2str(round(r*100)/100)),'FontWeight','Normal', 'FontSize',12)

subplot(5, 3, 7)
scatter(e(:,15), e(:,17), 100, AZred, '.'); hold on 
p = polyfit(e(:,15), e(:,17),1)
f = polyval(p, e(:,15))
plot(e(:,15), f, 'color', AZblue, 'LineWidth',3)
ylabel(label{1,17})
xlabel(label{1,15})
% ylim([0,1.1])
set(gca,'FontSize',12)
[r, p] = corr(e(:,15), e(:,17));
text(-6.2, -.5,strcat('r =', {' '}, num2str(round(r*100)/100)),'FontWeight','Normal', 'FontSize',12)

subplot(5, 3, 8)
scatter(e(:,15), e(:,18), 100, AZred, '.'); hold on 
p = polyfit(e(:,15), e(:,18),1)
f = polyval(p, e(:,15))
plot(e(:,15), f, 'color', AZblue, 'LineWidth',3)
ylabel(label{1,18})
xlabel(label{1,15})
% ylim([0,1.1])
set(gca,'FontSize',12)
[r, p] = corr(e(:,15), e(:,18));
text(-6.2, -.5,strcat('r =', {' '}, num2str(round(r*100)/100)),'FontWeight','Normal', 'FontSize',12)

subplot(5, 3, 9)
scatter(e(:,15), e(:,19), 100, AZred, '.'); hold on 
p = polyfit(e(:,15), e(:,19),1)
f = polyval(p, e(:,15))
plot(e(:,15), f, 'color', AZblue, 'LineWidth',3)
ylabel(label{1,19})
xlabel(label{1,15})
% ylim([0,1.1])
set(gca,'FontSize',12)
[r, p] = corr(e(:,15), e(:,19));
text(-6.2, 28,strcat('r =', {' '}, num2str(round(r*100)/100)),'FontWeight','Normal', 'FontSize',12)

subplot(5, 3, 10)
scatter(e(:,16), e(:,17), 100, AZred, '.'); hold on 
p = polyfit(e(:,16), e(:,17),1)
f = polyval(p, e(:,16))
plot(e(:,16), f, 'color', AZblue, 'LineWidth',3)
ylabel(label{1,17})
xlabel(label{1,16})
% ylim([0,1.1])
set(gca,'FontSize',12)
[r, p] = corr(e(:,16), e(:,17));
text(-9.8, -.5,strcat('r =', {' '}, num2str(round(r*100)/100)),'FontWeight','Normal', 'FontSize',12)

subplot(5, 3, 11)
scatter(e(:,16), e(:,18), 100, AZred, '.'); hold on 
p = polyfit(e(:,16), e(:,18),1)
f = polyval(p, e(:,16))
plot(e(:,16), f, 'color', AZblue, 'LineWidth',3)
ylabel(label{1,18})
xlabel(label{1,16})
% ylim([0,1.1])
set(gca,'FontSize',12)
[r, p] = corr(e(:,16), e(:,18));
text(-9.7, -2,strcat('r =', {' '}, num2str(round(r*100)/100)),'FontWeight','Normal', 'FontSize',12)

subplot(5, 3, 12)
scatter(e(:,16), e(:,19), 100, AZred, '.'); hold on 
p = polyfit(e(:,16), e(:,19),1)
f = polyval(p, e(:,16))
plot(e(:,16), f, 'color', AZblue, 'LineWidth',3)
ylabel(label{1,19})
xlabel(label{1,16})
% ylim([0,1.1])
set(gca,'FontSize',12)
[r, p] = corr(e(:,16), e(:,19));
text(-9.5, 28,strcat('r =', {' '}, num2str(round(r*100)/100)),'FontWeight','Normal', 'FontSize',12)

subplot(5, 3, 13)
scatter(e(:,17), e(:,18), 100, AZred, '.'); hold on 
p = polyfit(e(:,17), e(:,18),1)
f = polyval(p, e(:,17))
plot(e(:,17), f, 'color', AZblue, 'LineWidth',3)
ylabel(label{1,18})
xlabel(label{1,17})
% ylim([0,1.1])
set(gca,'FontSize',12)
[r, p] = corr(e(:,17), e(:,18));
text(-9.5, -.5,strcat('r =', {' '}, num2str(round(r*100)/100)),'FontWeight','Normal', 'FontSize',12)

subplot(5, 3, 14)
scatter(e(:,17), e(:,19), 100, AZred, '.'); hold on 
p = polyfit(e(:,17), e(:,19),1)
f = polyval(p, e(:,17))
plot(e(:,17), f, 'color', AZblue, 'LineWidth',3)
ylabel(label{1,19})
xlabel(label{1,17})
% ylim([0,1.1])
set(gca,'FontSize',12)
[r, p] = corr(e(:,17), e(:,19));
text(-9.6, 28,strcat('r =', {' '}, num2str(round(r*100)/100)),'FontWeight','Normal', 'FontSize',12)

subplot(5, 3, 15)
scatter(e(:,18), e(:,19), 100, AZred, '.'); hold on 
p = polyfit(e(:,18), e(:,19),1)
f = polyval(p, e(:,18))
plot(e(:,18), f, 'color', AZblue, 'LineWidth',3)
ylabel(label{1,19})
xlabel(label{1,18})
% ylim([0,1.1])
set(gca,'FontSize',12)
[r, p] = corr(e(:,18), e(:,19));
text(-7.3, 28,strcat('r =', {' '}, num2str(round(r*100)/100)),'FontWeight','Normal', 'FontSize',12)

%% ***********************************************  Functions for model fitting ***********************************************
function fit = model1(h, dR, I, c5)
    X0 = [0 0 10];           % information bonus, spatial bias, decision noise
    LB = [-100 -100 0];
    UB = [100 100 100];
    
    dR13_h1 = dR(h == 1 & I ~= 0);
    dR13_h6 = dR(h == 6 & I ~= 0);           % 1-3 conditions;
    
    I13_h1 = I(h == 1 & I ~= 0);
    I13_h6 = I(h == 6 & I ~= 0);
    
    c5_13_h1 = c5(h == 1 & I ~= 0);
    c5_13_h6 = c5(h == 6 & I ~= 0);
    
    func13_h1 = @(x) likelihood13(dR13_h1, I13_h1, c5_13_h1, x);
    x13_h1 = fmincon(func13_h1, X0, [], [], [], [], LB, UB);
    
    fit.x13_h1(1) = x13_h1(1);
    fit.x13_h1(2) = x13_h1(2);
    fit.x13_h1(3) = x13_h1(3);
    
    func13_h6 = @(x) likelihood13(dR13_h6, I13_h6, c5_13_h6, x);
    x13_h6 = fmincon(func13_h6, X0, [], [], [], [], LB, UB);
    
    fit.x13_h6(1) = x13_h6(1);
    fit.x13_h6(2) = x13_h6(2);
    fit.x13_h6(3) = x13_h6(3);
    
    dR22_h1 = dR(h == 1 & I == 0);
    dR22_h6 = dR(h == 6 & I == 0);           % 2-2 conditions;
    
    I22_h1 = I(h == 1 & I == 0);
    I22_h6 = I(h == 6 & I == 0);
    
    c5_22_h1 = c5(h == 1 & I == 0);
    c5_22_h6 = c5(h == 6 & I == 0);
    
    func22_h1 = @(x) likelihood22(dR22_h1, I22_h1, c5_22_h1, x);
    x22_h1 = fmincon(func22_h1, X0, [], [], [], [], LB, UB);
    
    fit.x22_h1(1) = x22_h1(1);
    fit.x22_h1(2) = x22_h1(2);
    fit.x22_h1(3) = x22_h1(3);
    
    func22_h6 = @(x) likelihood22(dR22_h6, I22_h6, c5_22_h6, x);
    x22_h6 = fmincon(func22_h6, X0, [], [], [], [], LB, UB);
    
    fit.x22_h6(1) = x22_h6(1);
    fit.x22_h6(2) = x22_h6(2);
    fit.x22_h6(3) = x22_h6(3);
end   

function L = likelihood13 (dR, I, c5, x)
    alpha = x(1);
    B = x(2);
    sigma = x(3);
    
    dQ = dR + alpha*I + B;
    P = 1 ./ (1+exp(dQ/(sigma*sqrt(2))));
    
    logP1 = log(P(c5==1));
    logP2 = log(1-P(c5==0));
    
    L_A = gaussianPrior(alpha, 0, 20);
    L_noise = exponentialPrior(sigma, 1/20);
    
    L = -sum(logP1) - sum(logP2) - L_A - L_noise;
end

function L = likelihood22 (dR, ~, c5, x)
    B = x(2);
    sigma = x(3);
    
    dQ = dR + B;
    P = 1 ./ (1+exp(dQ/(sigma*sqrt(2))));
    
    logP1 = log(P(c5==1));
    logP2 = log(1-P(c5==0));
    
    L_noise = exponentialPrior(sigma, 1/20);
    
    L = -sum(logP1) - sum(logP2) - L_noise;
end

function logP = exponentialPrior(x, lambda)
    logP = -lambda * x;
end

function logP = gaussianPrior(x, mu, sigma)
    logP = -(x-mu).^2/sigma^2/2 - log(sqrt(2*pi)*sigma);
end


